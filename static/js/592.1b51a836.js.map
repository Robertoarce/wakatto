{"version":3,"file":"static/js/592.1b51a836.js","mappings":"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","sources":["src/services/idleConversationPrompts.ts"],"sourcesContent":["/**\n * Idle Conversation Prompts\n *\n * Contains topic pools and prompt templates for generating character-to-character\n * conversations when the user is idle.\n */\n\nimport { getCharacter } from '../config/characters';\nimport { OrchestrationScene, CharacterTimeline, AnimationSegment, parseOrchestrationScene } from './animationOrchestration';\nimport { AnimationState } from '../components/CharacterDisplay3D';\nimport { generateAIResponseStreaming, isStreamingSupported } from './aiService';\nimport { getVoiceOptionsForPrompt } from '../config/voiceConfig';\n\n// ============================================\n// TOPIC POOLS\n// ============================================\n\n/**\n * Gossip and story starters - these lead to longer, more engaging conversations\n */\nconst GOSSIP_STARTERS = [\n  \"Dude, you would NOT believe who I saw at the grocery store yesterday...\",\n  \"Okay so I wasn't going to say anything but... I heard something WILD about one of our colleagues\",\n  \"Wait wait wait - did you hear what happened at the psychology conference last week?\",\n  \"So I was at this coffee shop right, and guess who walks in looking completely disheveled...\",\n  \"I probably shouldn't tell you this but... I saw someone's browser history and OH MY GOD\",\n  \"Okay promise you won't tell anyone but I overheard the JUICIEST conversation...\",\n  \"You're never gonna guess what I found in my old office when I was cleaning...\",\n  \"So remember that patient everyone thought was 'cured'? Yeah well guess what...\",\n  \"I ran into your old rival at a party and they said THE most ridiculous thing about you\",\n  \"Okay so hypothetically... if someone accidentally sent an email to the wrong person...\",\n];\n\n/**\n * Fun debate topics that naturally lead to back-and-forth\n */\nconst DEBATE_TOPICS = [\n  \"I've been thinking... is a hot dog a sandwich? This is important.\",\n  \"Okay settle this for me - is it okay to recline your seat on an airplane?\",\n  \"Here's a question that's been keeping me up at night - do we have free will or not?\",\n  \"I need your honest opinion... is my beard/hairstyle outdated?\",\n  \"Real talk - whose psychological theory is actually more useful in the real world?\",\n  \"Be honest with me - do you think I come across as pretentious in my writings?\",\n  \"I've always wondered... do you actually BELIEVE everything you wrote, or were you just trying to be provocative?\",\n  \"Let's play a game - if we had to swap theories for a week, could you actually do it?\",\n];\n\n/**\n * Personal stories and memories\n */\nconst PERSONAL_STORIES = [\n  \"You know what I was just remembering? That absolutely DISASTROUS lecture I gave in Vienna...\",\n  \"I never told anyone this, but there was this one patient who completely changed how I see everything...\",\n  \"So there's this recurring dream I keep having and honestly it's starting to freak me out...\",\n  \"I found my old journal from when I was just starting out... SO embarrassing\",\n  \"Remember when we used to argue about everything? I kind of miss those days actually...\",\n  \"I've been meaning to ask you - what did you REALLY think when you first read my work?\",\n  \"Can I confess something? Sometimes I wonder if I got it all wrong...\",\n  \"The other day I was people-watching and I saw this couple that reminded me of a case...\",\n];\n\n/**\n * Get a random conversation starter\n */\nfunction getRandomStarter(): string {\n  const allStarters = [...GOSSIP_STARTERS, ...DEBATE_TOPICS, ...PERSONAL_STORIES];\n  return allStarters[Math.floor(Math.random() * allStarters.length)];\n}\n\n// ============================================\n// PROMPT BUILDING\n// ============================================\n\n/**\n * Build the LLM prompt for an idle conversation between characters\n */\nexport function buildIdleConversationPrompt(\n  selectedCharacters: string[],\n  conversationNumber: number\n): string {\n  const starter = getRandomStarter();\n\n  // Build character profiles with positions\n  const characterProfiles = selectedCharacters.map((charId, index) => {\n    const character = getCharacter(charId);\n    const pos = index === 0 ? 'L (left)' : index === 1 ? 'C (center)' : 'R (right)';\n\n    return `### ${character.name} (${charId}, Position: ${pos})\n${character.description}`;\n  }).join('\\n\\n');\n\n  return `# Secret Character Conversation - LONG GOSSIP SESSION\n\nYou are generating a SECRET, EXTENDED conversation between characters who think the user isn't watching.\nThey're having a genuine heart-to-heart, gossiping, debating, and being their authentic selves.\n\n## CONVERSATION STYLE\n- This is like overhearing two friends at a bar - LONG, meandering, entertaining\n- They gossip, tease each other, share stories, change subjects naturally\n- They reference their own theories, famous quotes, and history in casual/funny ways\n- They can get excited, interrupt each other, go on tangents, then come back\n- Include reactions like \"No way!\", \"Wait what?!\", \"Oh come ON\", \"Okay but seriously though...\"\n\n## CRITICAL RULES\n1. Characters talk TO EACH OTHER, not to the user - they think no one is watching!\n2. **GENERATE 12-20 EXCHANGES** - this should be a LONG conversation (60-120 seconds total)\n3. Start with the provided conversation starter, then let it evolve naturally\n4. The conversation should shift through 2-3 different sub-topics organically\n5. Each character MUST face the other using lookDirection:\n   - LEFT position character: look \"at_right_character\"\n   - RIGHT position character: look \"at_left_character\"\n   - CENTER position: look at whoever they're addressing\n6. Natural timing: 1500-3000ms pauses between turns (startDelay)\n7. Use expressive animations - laugh, facepalm, lean_forward, cross_arms, shrug, etc.\n\n## CONVERSATION STARTER (First character opens with this or similar):\n\"${starter}\"\n\n## Characters\n${characterProfiles}\n\n## Animation System\nBody: idle,thinking,talking,confused,happy,excited,winning,jump,surprise_jump,lean_back,lean_forward,cross_arms,nod,shake_head,shrug,wave,point,clap,bow,facepalm,dance,laugh,cry,angry,nervous,celebrate,peek\nLook: center,left,right,up,down,at_left_character,at_right_character\nEye: open,closed,wink_left,wink_right,blink | Eyebrow: normal,raised,furrowed,sad,worried,one_raised\nMouth: closed,open,smile,wide_smile,surprised | Face: normal,blush,sweat_drop,sparkle_eyes\n\n## Voice (optional \"v\" object per segment)\n${getVoiceOptionsForPrompt()}\n\n## Output Format (COMPACT JSON - SIMPLIFIED)\nUse short keys: s=scene, ch=characters, c=character, t=content, ord=speaker order (1,2,3...), a=animation, sp=speed, lk=look, ex=expression, ey=eyes, eb=eyebrow, m=mouth\nSpeed (sp): \"slow\" | \"normal\" | \"fast\" | \"explosive\"\n\nEXAMPLE STRUCTURE (showing variety - your conversation should be LONGER with 12-20 exchanges):\n{\"s\":{\"ch\":[\n{\"c\":\"freud\",\"t\":\"Dude, you would NOT believe who I saw at the grocery store yesterday...\",\"ord\":1,\"a\":\"lean_forward\",\"sp\":\"fast\",\"lk\":\"at_right_character\",\"ex\":\"excited\",\"eb\":\"raised\"},\n{\"c\":\"jung\",\"t\":\"Who? Don't leave me hanging!\",\"ord\":2,\"a\":\"excited\",\"sp\":\"fast\",\"lk\":\"at_left_character\",\"ex\":\"curious\"},\n{\"c\":\"freud\",\"t\":\"Remember that patient who kept insisting his mother was actually a lamp? THAT guy.\",\"ord\":3,\"a\":\"talking\",\"sp\":\"normal\",\"lk\":\"at_right_character\",\"ex\":\"amused\"},\n{\"c\":\"jung\",\"t\":\"NO. What was he buying?\",\"ord\":4,\"a\":\"surprise_jump\",\"sp\":\"fast\",\"lk\":\"at_left_character\",\"ex\":\"shocked\"},\n{\"c\":\"freud\",\"t\":\"Lightbulbs. I am NOT joking. An entire cart full of lightbulbs.\",\"ord\":5,\"a\":\"facepalm\",\"sp\":\"slow\",\"lk\":\"at_right_character\",\"ex\":\"exasperated\"},\n{\"c\":\"jung\",\"t\":\"Oh my god. Okay but honestly? That's kind of poetic in a weird way.\",\"ord\":6,\"a\":\"laugh\",\"sp\":\"normal\",\"lk\":\"at_left_character\",\"ex\":\"amused\",\"m\":\"smile\"},\n{\"c\":\"freud\",\"t\":\"Don't you DARE try to find meaning in that. Not everything is an archetype.\",\"ord\":7,\"a\":\"cross_arms\",\"sp\":\"fast\",\"lk\":\"at_right_character\",\"ex\":\"annoyed\",\"eb\":\"furrowed\"},\n{\"c\":\"jung\",\"t\":\"Speaking of which... okay this is totally unrelated but I've been meaning to ask you something.\",\"ord\":8,\"a\":\"thinking\",\"sp\":\"slow\",\"lk\":\"at_left_character\",\"ex\":\"thoughtful\"}\n]}}\n(Continue for 12-20 total exchanges!)\n\n## Important\n- Character ID in \"c\" field (like \"freud\"), NOT display name\n- No \"Freud:\" prefixes in the text - just dialogue\n- Make it feel REAL and LONG - like eavesdropping on actual friends\n- Include emotional variety: laughing, getting defensive, being surprised, teasing\n- Let the conversation BREATHE - natural pauses, reactions, topic shifts\n\nGenerate the full secret conversation now (12-20 exchanges, 60-120 seconds total).`;\n}\n\n// ============================================\n// SCENE GENERATION\n// ============================================\n\n/**\n * Generate an idle conversation scene\n */\nexport async function generateIdleConversationScene(\n  selectedCharacters: string[],\n  conversationNumber: number\n): Promise<OrchestrationScene> {\n  const prompt = buildIdleConversationPrompt(selectedCharacters, conversationNumber);\n\n  // Anthropic API requires at least one user message - use a trigger message\n  const conversationMessages: Array<{ role: 'user' | 'assistant'; content: string }> = [\n    { role: 'user', content: 'Generate the secret conversation between the characters now.' }\n  ];\n\n  let rawResponse = '';\n\n  try {\n    if (isStreamingSupported()) {\n      rawResponse = await generateAIResponseStreaming(\n        conversationMessages,\n        prompt,\n        'orchestrator',\n        {\n          onError: (error) => {\n            console.error('[IdlePrompts] Stream error:', error);\n          },\n        }\n      );\n    } else {\n      throw new Error('Non-streaming not implemented for idle conversations');\n    }\n  } catch (error) {\n    console.error('[IdlePrompts] Error generating idle conversation:', error);\n    return createFallbackIdleScene(selectedCharacters);\n  }\n\n  // Parse the response\n  let scene = parseOrchestrationScene(rawResponse, selectedCharacters);\n\n  if (!scene) {\n    return createFallbackIdleScene(selectedCharacters);\n  }\n\n  // Ensure all characters face each other (validation)\n  scene = enforceCharacterFacing(scene, selectedCharacters);\n\n  return scene;\n}\n\n/**\n * Enforce that characters ALWAYS face each other during idle conversations.\n * This overrides ANY lookDirection from the AI to ensure characters are always\n * facing each other until the user returns.\n */\nfunction enforceCharacterFacing(\n  scene: OrchestrationScene,\n  selectedCharacters: string[]\n): OrchestrationScene {\n  const characterPositions: Record<string, 'left' | 'center' | 'right'> = {};\n  selectedCharacters.forEach((charId, index) => {\n    characterPositions[charId] = index === 0 ? 'left' : index === selectedCharacters.length - 1 ? 'right' : 'center';\n  });\n\n  // ALWAYS override lookDirection to face other character - no exceptions\n  scene.timelines = scene.timelines.map(timeline => {\n    const position = characterPositions[timeline.characterId];\n    // Left character always looks at right character, right looks at left\n    const forcedLookDirection = position === 'left' ? 'at_right_character' :\n                                position === 'right' ? 'at_left_character' :\n                                'at_right_character'; // center defaults to right\n\n    timeline.segments = timeline.segments.map(segment => {\n      // FORCE lookDirection for ALL segments - override whatever AI generated\n      segment.complementary = {\n        ...segment.complementary,\n        lookDirection: forcedLookDirection as any\n      };\n      return segment;\n    });\n\n    return timeline;\n  });\n\n  return scene;\n}\n\n/**\n * Create a simple fallback scene if generation fails\n */\nfunction createFallbackIdleScene(selectedCharacters: string[]): OrchestrationScene {\n  const fallbackLines = [\n    { text: \"So... nice weather we're having.\", animation: 'idle' as AnimationState },\n    { text: \"Indeed. Very... weather-like.\", animation: 'nod' as AnimationState },\n  ];\n\n  const timelines: CharacterTimeline[] = selectedCharacters.slice(0, 2).map((charId, index) => {\n    const line = fallbackLines[index % fallbackLines.length];\n    const isLeft = index === 0;\n    const lookDirection = isLeft ? 'at_right_character' : 'at_left_character';\n\n    return {\n      characterId: charId,\n      content: line.text,\n      totalDuration: 3000,\n      startDelay: index * 4000,\n      segments: [\n        {\n          animation: line.animation,\n          duration: 800,\n          isTalking: false,\n          complementary: { lookDirection: lookDirection as any }\n        },\n        {\n          animation: 'talking' as AnimationState,\n          duration: 2200,\n          isTalking: true,\n          textReveal: { startIndex: 0, endIndex: line.text.length },\n          complementary: { lookDirection: lookDirection as any, mouthState: 'open' }\n        }\n      ]\n    };\n  });\n\n  return {\n    timelines,\n    sceneDuration: 8000,\n    nonSpeakerBehavior: {}\n  };\n}\n\n// ============================================\n// EXPORTS\n// ============================================\n\nexport {\n  GOSSIP_STARTERS,\n  DEBATE_TOPICS,\n  PERSONAL_STORIES,\n  getRandomStarter,\n};\n"],"names":["GOSSIP_STARTERS","DEBATE_TOPICS","PERSONAL_STORIES","getRandomStarter","allStarters","concat","Math","floor","random","length","buildIdleConversationPrompt","selectedCharacters","conversationNumber","map","charId","index","character","getCharacter","pos","name","description","join","getVoiceOptionsForPrompt","generateIdleConversationScene","_x","_x2","_generateIdleConversationScene","apply","arguments","_asyncToGenerator","prompt","rawResponse","isStreamingSupported","Error","generateAIResponseStreaming","role","content","onError","error","console","createFallbackIdleScene","scene","parseOrchestrationScene","characterPositions","forEach","timelines","timeline","position","characterId","forcedLookDirection","segments","segment","complementary","_objectSpread","lookDirection","enforceCharacterFacing","fallbackLines","text","animation","slice","line","totalDuration","startDelay","duration","isTalking","textReveal","startIndex","endIndex","mouthState","sceneDuration","nonSpeakerBehavior"],"sourceRoot":""}